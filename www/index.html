<!DOCTYPE html>
<html lang="en">
    <head>
        <meta content="text/html;charset=utf-8" http-equiv="Content-Type" />
        <link href="style.css" rel="stylesheet" />
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/notyf@3/notyf.min.css"
        />
        <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
        <title>The Ray Tracer Challenge</title>
    </head>
    <body>
        <div id="grid-wrapper">
            <div class="header">
                <a href="https://github.com/SinclaM/ray-tracer-challenge">
                    <img id="github-image" src="github-logo.png" alt="" />
                </a>
                <div id="header-title">
                    The Ray Tracer Challenge
                    <span style="color: #f7a41e">(in Zig)</span>
                </div>
                <div id="scene-choices" class="select">
                    <select id="standard-select">
                        <option value="cover.json">Cover Scene</option>
                        <option value="cubes.json">Cubes</option>
                        <option value="cylinders.json">Cylinders</option>
                        <option value="reflection_and_refraction.json">
                            Reflection and Refraction
                        </option>
                        <option value="fresnel.json">Fresnel</option>
                        <option value="groups.json">Groups</option>
                        <option value="teapot.json">Teapot</option>
                        <option value="dragons.json">Dragons</option>
                        <option value="nefertiti.json">Nefertiti</option>
                        <option value="earth.json">Earth</option>
                        <option value="skybox.json">Skybox</option>
                        <option value="csg.json">Constructive Solid Geometry</option>
                        <option value="xyz.json">Raytracer REPL Default</option>
                        <option value="align_check.json">Align Check</option>
                    </select>
                    <span class="focus"></span>
                </div>
                <label for="add-file" id="add-file-label">
                    Add File<span class="plus-sign">+</span>
                </label>
                <input
                    id="add-file"
                    type="file"
                    accept=".obj,.bmp,.pam,.pbm,.pcx,.pgm,.png,.ppm,.qoi,.tga"
                    style="display: none"
                />
                <button id="render" role="button">Render</button>
            </div>
            <div class="split">
                <div id="split-0">
                    <div id="scene-description"></div>
                </div>
                <div id="split-1">
                    <canvas id="image-canvas"></canvas>
                    <div class="arrow-key-container">
                        <div class="arrow-key up" data-key="38"></div>
                        <br />
                        <div class="arrow-key left" data-key="37"></div>
                        <div class="arrow-key down" data-key="40"></div>
                        <div class="arrow-key right" data-key="39"></div>
                    </div>
                </div>
            </div>
            <div class="footer">
                <a href="https://ziglang.org/">
                    <img id="zig-logo" src="zig-logo.svg" alt="" />
                </a>
                +
                <a href="https://webassembly.org/">
                    <img id="wasm-logo" src="wasm-logo.png" alt="" />
                </a>
                == ðŸ”¥
            </div>
        </div>

        <script src="coi-serviceworker.min.js"></script>
        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/split.js/1.6.2/split.min.js"
            integrity="sha512-to2k78YjoNUq8+hnJS8AwFg/nrLRFLdYYalb18SlcsFRXavCOTfBF3lNyplKkLJeB8YjKVTb1FPHGSy9sXfSdg=="
            crossorigin="anonymous"
            referrerpolicy="no-referrer"
        ></script>

        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.23.3/ace.min.js"
            type="text/javascript"
            charset="utf-8"
        ></script>
        <script src="https://cdn.jsdelivr.net/npm/notyf@3/notyf.min.js"></script>
        <script>
            const initialMemorySize = 2560;

            const allowed = (maximum) => {
                try {
                    new WebAssembly.Memory({ initial: initialMemorySize, maximum, shared: true });
                    return true;
                } catch (RangeError) {
                    return false;
                }
            };

            const findMaximumMemorySize = () => {
                let maximum = initialMemorySize;

                while (maximum < 65536 && allowed(initialMemorySize, maximum)) {
                    maximum = Math.min(maximum * 2, 65536);
                }

                let left = initialMemorySize;
                let right = maximum;

                while (left < right) {
                    const mid = Math.ceil((left + right) / 2);

                    if (allowed(initialMemorySize, mid)) {
                        left = mid;
                    } else {
                        right = mid - 1;
                    }
                }

                return left;
            };

            const maximumMemorySize = findMaximumMemorySize();

            var Module = {
                wasmMemory: new WebAssembly.Memory({
                    initial: initialMemorySize,
                    maximum: maximumMemorySize,
                    shared: true,
                }),
            };
        </script>
        <script src="ray-tracer-challenge.js"></script>
        <script src="index.js"></script>
    </body>
</html>
